import pandas as pd
from pprint import pprint
import json

rows = []

with open("C:/Users/pixy/passml/dataset/ember_dataset/ember/train_features_0.jsonl") as f:
    for line in f:
        sample = json.loads(line);
        
        text_entropy = 0;
        rsrc_entropy = 0;

        #Scanning Entropy
        for sec in sample.get("section", {}).get("sections", []):
            if sec["name"] == ".text":
                text_entropy = sec.get("entropy", 0)
            elif sec["name"] == ".rsrc":
                rsrc_entropy = sec.get("entropy", 0)
        
        rows.append({
            "file_size": sample["general"].get("size", 0),
            "virtual_size": sample["general"].get("vsize", 0),
            "imports": sample["general"].get("imports", 0),
            "exports": sample["general"].get("exports", 0),
            "sections": len(sample["section"]["sections"]) if "section" in sample else 0,
            "has_signature": sample["general"].get("has_signature", 0),
            "has_tls": sample["general"].get("has_tls", 0),
            "text_entropy": text_entropy,
            "rsrc_entropy": rsrc_entropy
        })

data = pd.DataFrame(rows);
print(data.head(10));
        
